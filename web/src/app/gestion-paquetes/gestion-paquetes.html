<div class="admin-layout">
  <app-sidebar></app-sidebar>
  <div class="main-content">
    <!-- Header de la sección: título a la izquierda y botón a la derecha.
     El botón abre un modal para crear un nuevo paquete (evento abrirModalCrear) -->
    <div class="header-gestion-paquetes">
      <h2 class="titulo-pagina">Gestión de Paquetes</h2>
      <button class="crear-paquete-btn" (click)="abrirModalCrear()">
        <span class="icono-crear">
          <!-- Icono Plus Circle -->
          <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <circle cx="12" cy="12" r="9" stroke-width="1.5"/>
        <path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 8v8m4-4H8"/>
      </svg>
        </span>
        Crear paquete
      </button>
    </div>
    
    <div class="filtros-outer-container">
  <div class="filtros-container">
    <input type="text" id="filtroNombre" placeholder="Nombre">
    <select id="filtroEstado">
      <option value="">Estado</option>
      <option value="activo">Activo</option>
      <option value="inactivo">Inactivo</option>
    </select>
    <input type="number" id="filtroPrecio" min="0" placeholder="Precio máx.">
    <input type="number" id="filtroDuracion" min="1" placeholder="Duración (días)">
    <input type="number" id="filtroCupo" min="1" placeholder="Cupo mín.">

    <!-- Botón lupa para filtrar -->
    <button type="button" class="btn-lupa-filtrar" (click)="filtrarPaquetes()" title="Filtrar">
      <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <circle cx="11" cy="11" r="7" stroke-width="2"/>
        <line x1="16.5" y1="16.5" x2="21" y2="21" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <!-- Botón para reiniciar filtros -->
    <button type="button" class="btn-reiniciar-filtros" (click)="reiniciarFiltros()" title="Reiniciar filtros">
      <!-- Puedes usar solo texto, o un icono de reinicio (SVG) -->
      <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path d="M4 4v5h5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M20 20v-5h-5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M5.07 19A9 9 0 1 1 12 21a9 9 0 0 1-6.93-2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <!-- O solo texto: -->
      <!-- <span>Reiniciar</span> -->
    </button>
  </div>
</div>
    <!-- Lista de todos los paquetes -->
    <div class="lista-paquetes">
      <div class="tarjeta-carta" *ngFor="let paquete of paquetes" (click)="seleccionarPaquete(paquete)">
        <div class="container-imagen">
          <!-- Carrusel de imágenes: flecha izquierda, imagen actual, flecha derecha -->
          <button 
    type="button" 
    class="flecha-carrusel flecha-izquierda" 
    (click)="cambiarImagenTarjeta(paquete, -1); $event.stopPropagation()" 
    *ngIf="(paquete.imagenes?.length || 0) > 1">
    ‹
  </button>
  <img class="foto-paquete"
      [src]="getImagenActualTarjeta(paquete)"
      (click)="abrirImagenAmpliada(getImagenActualTarjeta(paquete))"
      style="cursor: zoom-in"
      (error)="cargarImagenPredeterminada($event)"
      [alt]="'Imagen de ' + paquete.nombre">
  <button 
    type="button" 
    class="flecha-carrusel flecha-derecha" 
    (click)="cambiarImagenTarjeta(paquete, 1); $event.stopPropagation()" 
    *ngIf="(paquete.imagenes?.length || 0) > 1">
    ›
  </button>
        </div>
        <div class="campos-paquete">
          <div class="fila-paquete">
            <h2 class="titulo-paquete">{{ paquete.nombre }}</h2>
            <span class="precio-paquete">{{ paquete.precio }}&nbsp;€</span>
          </div>
          <p class="descripcion-paquete">{{ paquete.descripcion }}</p>
        </div>
        <div class="acciones-paquete">
          <button class="editar-paquete" (click)="abrirModal(paquete)">Editar</button> <!-- Botón para que se abra el modal editar el paquete -->
          <button class="eliminar-paquete" (click)="abrirModalEliminar(paquete)">Eliminar</button> <!-- Botón para que se abra el modal de confirmación de eliminación del paquete -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Edición -->
  <div class="modal-backdrop" *ngIf="modalAbierto" (click)="cerrarModal()"></div>   <!-- ngIf, si el modal esta abierto, podrás darle click para cerrarlo -->
  <div class="modal-editar" *ngIf="modalAbierto"> <!-- Si el modal está abierto, se muestra el contenido -->
    <div class="modal-header">
  <h3>{{ modoCreacion ? 'Crear Paquete' : 'Editar Paquete' }}</h3>      
  <button class="cerrar-modal" (click)="cerrarModal()">×</button> <!-- Botón para cerrar el modal -->
    </div>
    <div class="modal-body">
      <form [formGroup]="formularioPaquete" (ngSubmit)="guardarCambios()">
        <div class="form-group">
          <label for="nombre">Nombre:</label>
          <input type="text" id="nombre" formControlName="nombre" class="form-input">
          <div class="error-msg" *ngIf="formularioPaquete.get('nombre')?.invalid && formularioPaquete.get('nombre')?.touched">
            El nombre es obligatorio
          </div>
        </div>
        
        <div class="form-group">
          <label for="descripcion">Descripción:</label>
          <textarea id="descripcion" formControlName="descripcion" class="form-input" rows="3"></textarea>
          <div class="error-msg" *ngIf="formularioPaquete.get('descripcion')?.invalid && formularioPaquete.get('descripcion')?.touched">
            La descripción es obligatoria
          </div>
        </div>
        
        <div class="form-group">
          <label for="precio">Precio (€):</label>
          <input type="number" id="precio" formControlName="precio" class="form-input">
          <div class="error-msg" *ngIf="formularioPaquete.get('precio')?.invalid && formularioPaquete.get('precio')?.touched">
            El precio debe ser mayor que 0
          </div>
        </div>
        
        <div class="form-group">
          <label for="duracion">Duración (días):</label>
          <input type="number" id="duracion" formControlName="duracion" class="form-input">
        </div>
        
        <div class="form-group">
          <label for="cupo">Cupo:</label>
          <input type="number" id="cupo" formControlName="cupo" class="form-input">
        </div>
        
        <div class="form-group">
          <label for="estado">Estado:</label>
          <select id="estado" formControlName="estado" class="form-input">
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="imagenes">Imágenes del paquete (opcional):</label>
          <input type="file" id="imagenes" (change)="onImagenesSeleccionadas($event)" multiple accept="image/*">
          <div class="preview-imagenes">
            <div class="preview-imagen" *ngFor="let img of imagenesPreview; let i = index">
      <img [src]="img.url" [alt]="'Imagen ' + (i+1)">
      <button type="button" class="btn-eliminar-imagen" (click)="eliminarImagenPreview(i)">×</button>
    </div>
    <!-- Imágenes ya existentes (en edición) -->
    <div class="preview-imagen" *ngFor="let img of imagenesExistentes; let j = index">
      <img [src]="corregirUrl(img.imagen_url)"
           (click)="abrirImagenAmpliada(corregirUrl(img.imagen_url))"
           style="cursor: zoom-in"
           [alt]="img.descripcion || 'Imagen existente'">
      <button type="button" class="btn-eliminar-imagen" (click)="eliminarImagenExistente(j)">×</button>
    </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn-cancelar" (click)="cerrarModal()">Cancelar</button>
          <button type="submit" class="btn-guardar" [disabled]="formularioPaquete.invalid">Guardar</button> <!-- Botón para guardar los cambios del formulario -->
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Confirmación de Eliminación -->
  <div class="modal-backdrop" *ngIf="modalEliminarAbierto" (click)="cerrarModalEliminar()"></div> <!-- ngIf, si el modal de eliminar esta abierto, podrás darle click para cerrarlo -->
  <div class="modal-confirmar" *ngIf="modalEliminarAbierto"> <!-- Si el modal está abierto, se muestra el contenido -->
    <div class="modal-header">
      <h3>Confirmar Eliminación</h3>
      <button class="cerrar-modal" (click)="cerrarModalEliminar()">×</button> <!-- Botón para cerrar el modal -->
    </div>
    <div class="modal-body">
      <p class="mensaje-eliminar">¿Estás seguro de que deseas eliminar el paquete <strong>{{ paqueteActual.nombre }}</strong>?</p>
      <p class="advertencia-eliminar">Esta acción no se puede deshacer.</p>
    </div>
    <div class="modal-footer footer-eliminar">
      <!-- Botones centrados para confirmar o cancelar la eliminación -->
      <div class="botones-confirmacion">
        <button type="button" class="btn-cancelar" (click)="cerrarModalEliminar()">Cancelar</button> <!-- Botón para cancelar la eliminación -->
        <button type="button" class="btn-eliminar" (click)="eliminarPaquete()">Eliminar</button> <!-- Botón para confirmar la eliminación -->
      </div>
    </div>
  </div>

  <!-- Modal de Imagen Ampliada -->
  <div class="modal-backdrop" *ngIf="imagenAmpliada" (click)="cerrarImagenAmpliada()"></div>
<div class="modal-imagen-ampliada" *ngIf="imagenAmpliada">
  <img [src]="imagenAmpliada" alt="Imagen ampliada" />
  <button class="cerrar-modal" (click)="cerrarImagenAmpliada()">×</button>
</div>
</div>