<div class="admin-layout">
  <app-sidebar></app-sidebar>
  <div class="main-content">
    <!-- Header de la sección: título a la izquierda y botón a la derecha.
     El botón abre un modal para crear un nuevo paquete (evento abrirModalCrear) -->
    <div class="header-gestion-paquetes">
      <h2 class="titulo-pagina">Gestión de Paquetes</h2>
      <button class="crear-paquete-btn" (click)="abrirModalCrear()">
        <span class="icono-crear">
          <!-- Icono Plus Circle -->
          <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <circle cx="12" cy="12" r="9" stroke-width="1.5"/>
        <path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M12 8v8m4-4H8"/>
      </svg>
        </span>
        Crear paquete
      </button>
    </div>
    
    <!-- Lista de todos los paquetes -->
    <div class="lista-paquetes">
      <div class="tarjeta-carta" *ngFor="let paquete of paquetes" (click)="seleccionarPaquete(paquete)">
        <div class="container-imagen">
          <!-- Reemplazamos la URL fija por la propiedad imagen_url del paquete -->
          <!-- Si hay error al cargar la imagen, se usa el método cargarImagenPredeterminada -->
          <img class="foto-paquete" 
              [src]="paquete.imagen_url" 
              (error)="cargarImagenPredeterminada($event)"
              [alt]="'Imagen de ' + paquete.nombre">
        </div>
        <div class="campos-paquete">
          <div class="fila-paquete">
            <h2 class="titulo-paquete">{{ paquete.nombre }}</h2>
            <span class="precio-paquete">{{ paquete.precio }}&nbsp;€</span>
          </div>
          <p class="descripcion-paquete">{{ paquete.descripcion }}</p>
        </div>
        <div class="acciones-paquete">
          <button class="editar-paquete" (click)="abrirModal(paquete)">Editar</button> <!-- Botón para que se abra el modal editar el paquete -->
          <button class="eliminar-paquete" (click)="abrirModalEliminar(paquete)">Eliminar</button> <!-- Botón para que se abra el modal de confirmación de eliminación del paquete -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Edición -->
  <div class="modal-backdrop" *ngIf="modalAbierto" (click)="cerrarModal()"></div>   <!-- ngIf, si el modal esta abierto, podrás darle click para cerrarlo -->
  <div class="modal-editar" *ngIf="modalAbierto"> <!-- Si el modal está abierto, se muestra el contenido -->
    <div class="modal-header">
  <h3>{{ modoCreacion ? 'Crear Paquete' : 'Editar Paquete' }}</h3>      
  <button class="cerrar-modal" (click)="cerrarModal()">×</button> <!-- Botón para cerrar el modal -->
    </div>
    <div class="modal-body">
      <form [formGroup]="formularioPaquete" (ngSubmit)="guardarCambios()">
        <div class="form-group">
          <label for="nombre">Nombre:</label>
          <input type="text" id="nombre" formControlName="nombre" class="form-input">
          <div class="error-msg" *ngIf="formularioPaquete.get('nombre')?.invalid && formularioPaquete.get('nombre')?.touched">
            El nombre es obligatorio
          </div>
        </div>
        
        <div class="form-group">
          <label for="descripcion">Descripción:</label>
          <textarea id="descripcion" formControlName="descripcion" class="form-input" rows="3"></textarea>
          <div class="error-msg" *ngIf="formularioPaquete.get('descripcion')?.invalid && formularioPaquete.get('descripcion')?.touched">
            La descripción es obligatoria
          </div>
        </div>
        
        <div class="form-group">
          <label for="precio">Precio (€):</label>
          <input type="number" id="precio" formControlName="precio" class="form-input">
          <div class="error-msg" *ngIf="formularioPaquete.get('precio')?.invalid && formularioPaquete.get('precio')?.touched">
            El precio debe ser mayor que 0
          </div>
        </div>
        
        <div class="form-group">
          <label for="duracion">Duración (días):</label>
          <input type="number" id="duracion" formControlName="duracion" class="form-input">
        </div>
        
        <div class="form-group">
          <label for="cupo">Cupo:</label>
          <input type="number" id="cupo" formControlName="cupo" class="form-input">
        </div>
        
        <div class="form-group">
          <label for="estado">Estado:</label>
          <select id="estado" formControlName="estado" class="form-input">
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
          </select>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-cancelar" (click)="cerrarModal()">Cancelar</button>
          <button type="submit" class="btn-guardar" [disabled]="formularioPaquete.invalid">Guardar</button> <!-- Botón para guardar los cambios del formulario -->
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Confirmación de Eliminación -->
  <div class="modal-backdrop" *ngIf="modalEliminarAbierto" (click)="cerrarModalEliminar()"></div> <!-- ngIf, si el modal de eliminar esta abierto, podrás darle click para cerrarlo -->
  <div class="modal-confirmar" *ngIf="modalEliminarAbierto"> <!-- Si el modal está abierto, se muestra el contenido -->
    <div class="modal-header">
      <h3>Confirmar Eliminación</h3>
      <button class="cerrar-modal" (click)="cerrarModalEliminar()">×</button> <!-- Botón para cerrar el modal -->
    </div>
    <div class="modal-body">
      <p class="mensaje-eliminar">¿Estás seguro de que deseas eliminar el paquete <strong>{{ paqueteActual.nombre }}</strong>?</p>
      <p class="advertencia-eliminar">Esta acción no se puede deshacer.</p>
    </div>
    <div class="modal-footer footer-eliminar">
      <!-- Botones centrados para confirmar o cancelar la eliminación -->
      <div class="botones-confirmacion">
        <button type="button" class="btn-cancelar" (click)="cerrarModalEliminar()">Cancelar</button> <!-- Botón para cancelar la eliminación -->
        <button type="button" class="btn-eliminar" (click)="eliminarPaquete()">Eliminar</button> <!-- Botón para confirmar la eliminación -->
      </div>
    </div>
  </div>
</div>